generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}
model User {
  id                              String         @id @default(auto()) @map("_id") @db.ObjectId
  role                            UserRole
  role_token 					  String		 @unique
  username                        String		 
  email                           String         @unique
  jwt_token                       String         @unique
  password                        String
  corridas                        Corrida[]
  agendamendos                    Agendamento[]
  created_at                      DateTime @default(now())
  updated_at                      DateTime?

  @@map("users")
}

enum UserRole {
  GESTOR
  AFILIADO
  COMUM
}

model Pista {
  id                 String    @id @default(auto()) @map("_id") @db.ObjectId
  name               String
  km                 Int
  quantidade_boxes   Int
  quantidade_lugares Int
  endereco           String
  created_at         DateTime @default(now())
  updated_at         DateTime?

  corridas     Corrida[]
  agendamentos Agendamento[]

  @@map("pistas")
}

model Kart {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  status      KartStatus
  name        String
  marca       String
  modelo      String
  potencia    Int
  marca_pneus String
  created_at  DateTime @default(now())
  updated_at  DateTime?

  manutencoes  Manutencao[]
  corridas     Corrida[]
  agendamentos Agendamento[]

  @@map("karts")
}

enum KartStatus {
  LOCADO
  MANUTENCAO
  LIVRE
}

model Agendamento {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  user_id     String     @db.ObjectId
  kart_id     String     @db.ObjectId
  kart_status KartStatus
  pista_id    String     @db.ObjectId
  starts_at   DateTime
  ends_at     DateTime
  created_at  DateTime @default(now())
  updated_at  DateTime?

  user  User  @relation(fields: [user_id], references: [id])
  kart  Kart  @relation(fields: [kart_id], references: [id])
  pista Pista @relation(fields: [pista_id], references: [id])

  @@map("agendamentos")
}

model Corrida {
  id                             String    @id @default(auto()) @map("_id") @db.ObjectId
  user_id                        String    @db.ObjectId
  kart_id                        String    @db.ObjectId
  pista_id                       String    @db.ObjectId
  starts_at                      DateTime
  has_agendamento_in_this_period Boolean
  created_at                     DateTime @default(now())
  updated_at                     DateTime?

  user  User  @relation(fields: [user_id], references: [id])
  kart  Kart  @relation(fields: [kart_id], references: [id])
  pista Pista @relation(fields: [pista_id], references: [id])

  @@map("corridas")
}

model Manutencao {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  kart_id    String    @db.ObjectId
  motivo     String
  starts_at  DateTime
  ends_at    DateTime
  finished   Boolean
  created_at DateTime @default(now())
  updated_at DateTime?

  kart Kart @relation(fields: [kart_id], references: [id])

  @@map("manutencoes")
}
